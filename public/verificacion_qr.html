<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verificaci√≥n</title>
</head>
<body>
  <h1>Esperando verificaci√≥n...</h1>
  <div id="estado">‚ùå No verificado</div>



  <script>
    // Tomamos el userId desde la URL
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('id');

    if (!userId) {
        document.getElementById("estado").textContent = "‚ùå Error: usuario no identificado";
        throw new Error("No se encontr√≥ userId en la URL");
    }

    // Conexi√≥n WebSocket al servidor Node.js (usar tu URL ngrok)
    const socket = new WebSocket("wss://multilobular-guarded-michelle.ngrok-free.dev");

    socket.onopen = () => {
        console.log("Conectado al servidor WebSocket");
        // Avisar al servidor que este usuario abri√≥ la p√°gina
        socket.send("usuario_abierto:" + userId);
    };

    socket.onmessage = (event) => {
    const data = event.data;
    console.log("üì© Mensaje del servidor:", data);

    if (data.includes("verificado")) {
      document.getElementById("estado").textContent = "‚úÖ Verificado";

      // üü¢ Esperamos un par de segundos y redirigimos autom√°ticamente:
      setTimeout(() => {
        window.location.href = "/pizzeria/ver_pedido.php?pedido_id=" + userId;
      }, 1500);
    }
  };

    

    socket.onerror = (err) => {
        console.error("Error WebSocket:", err);
    };

    socket.onclose = () => {
        console.log("Conexi√≥n WebSocket cerrada");
    };
  </script>
</body>
</html>
